name: CI - Testes Automatizados # nome da pipeline que aparecerá na aba Actions do GitHub

on: # define quais eventos disparam a execução da pipeline
  push: # executa quando há um push no repositório
    branches: [ "main", "develop" ] # somente se o push acontecer nessas branches
  pull_request: # também executa quando um PR é aberto ou atualizado

jobs: # início da definição dos jobs da pipeline
  testes: # nome do job
    runs-on: ubuntu-latest # máquina/runner onde o job será executado

    steps: # sequência de passos que o job irá executar
      - name: Checkout do código # etapa para baixar o código do repositório
        uses: actions/checkout@v4 # action oficial do GitHub para fazer o checkout

      - name: Configurar Java 21 # etapa que prepara o ambiente Java
        uses: actions/setup-java@v4 # action para instalação/configuração do Java
        with: # parâmetros da configuração
          distribution: 'temurin' # distribuição do OpenJDK
          java-version: '21' # versão do Java que será usada na execução
          cache: maven # habilita cache das dependências Maven para acelerar builds futuros

      - name: Executar testes automatizados # etapa que roda a suíte de testes
        run: mvn clean test # comando Maven que compila e executa os testes

      - name: Publicar relatórios de teste # etapa responsável por salvar os relatórios gerados
        if: always() # executa mesmo se os testes falharem
        uses: actions/upload-artifact@v4 # action que faz upload de arquivos como artefatos
        with: # parâmetros do upload
          name: relatorios-testes # nome do pacote que aparecerá para download
          path: | # caminhos dos arquivos/pastas que serão enviados
            target/surefire-reports # relatórios padrão do JUnit/Maven
            target/cucumber-reports # relatórios gerados pelo Cucumber
